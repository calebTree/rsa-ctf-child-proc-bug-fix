import os
import signal
import subprocess
import sys

timeout_s = 2

cmd = [
    'sage',
    '/home/kali/apps/RsaCtfTool/sage/ecm.sage',
    # '602400691612422154516282778947806249229526581'
    '26704136070190021268530677795105985884263361536622833934714426888426798665963518034656134699351969849578649269882577938793480570683691056722041783384495990587019100282789084323565697855562379540153332516779850690995663397706639210713389916468832374366672198412605881301513724575881325514230157189628217040662720724873409731892391430251108449468806031288847974398224502019544294525721217086971964279283183115289891371380447796261174525500007923713652805932399774761880950596925525730972278711118078161781852095293531902154870542539496778644054865834522716386911026357748701804307998796881754534349617288246197773646851'
]

# https://alexandra-zaharia.github.io/posts/kill-subprocess-and-its-children-on-timeout-python/
try:
    p = subprocess.Popen(cmd, start_new_session=True)
    p.wait(timeout=timeout_s)
except subprocess.TimeoutExpired:
    print(f'Timeout for {cmd} ({timeout_s}s) expired', file=sys.stderr)
    print('Terminating the whole process group...', file=sys.stderr)
    os.killpg(os.getpgid(p.pid), signal.SIGTERM)
